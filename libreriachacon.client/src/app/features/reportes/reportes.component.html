<!-- Content Header -->
<div class="content-header">
  <div class="container-fluid">
    <div class="row mb-2">
      <div class="col-sm-6">
        <h1 class="m-0">
          Informe de Ventas
        </h1>
      </div>
      <div class="col-sm-6">
       
      </div>
    </div>
  </div>
</div>

<!-- Main content -->
<section class="content">
  <div class="container-fluid">

    <!-- Filtros Card -->
    <div class="card filters-card">
      <div class="card-header">
        <h3 class="card-title">
          Filtros de Búsqueda
        </h3>
      </div>
      <div class="card-body">
        <form [formGroup]="filtroForm" class="filters-form">
          <mat-form-field appearance="outline" class="date-field">
            <mat-label>Rango de Fechas</mat-label>
            <mat-date-range-input [rangePicker]="picker">
              <input matStartDate formControlName="fechaInicio" placeholder="Fecha inicio">
              <input matEndDate formControlName="fechaFin" placeholder="Fecha fin">
            </mat-date-range-input>
            <mat-icon matPrefix>date_range</mat-icon>
            <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-date-range-picker #picker></mat-date-range-picker>
          </mat-form-field>

          <mat-form-field appearance="outline" class="type-field">
            <mat-label>Tipo de Venta</mat-label>
            <mat-select formControlName="tipoVenta">
              <mat-option value="Todas">Todas las ventas</mat-option>
              <mat-option value="EnLinea">Ventas en Línea</mat-option>
              <mat-option value="EnTienda">Ventas en Tienda</mat-option>
            </mat-select>
          </mat-form-field>

          <button mat-raised-button
                  color="primary"
                  class="generate-btn"
                  (click)="generarReporte()">
            <mat-icon>search</mat-icon>
            Generar Reporte
          </button>
        </form>
      </div>
    </div>

    <!-- Resultados -->
    <div *ngIf="dataSource.data.length > 0" class="results-section">

      <!-- Cards de Resumen -->
      <div class="summary-cards">
        <div class="summary-card card-total">
         
          <div class="card-content">
            <span class="card-label">Total Ventas</span>
            <span class="card-value">{{ totalGeneralVentas | currency:'GTQ':'Q' }}</span>
          </div>
        </div>

        <div class="summary-card card-neta">
          
          <div class="card-content">
            <span class="card-label">Venta Neta</span>
            <span class="card-value">{{ totalVentaNeta | currency:'GTQ':'Q' }}</span>
          </div>
        </div>

        <div class="summary-card card-ganancia">
          
          <div class="card-content">
            <span class="card-label">Ganancia Total</span>
            <span class="card-value">{{ totalGanancia | currency:'GTQ':'Q' }}</span>
          </div>
        </div>
      </div>

      <!-- Tabla de Datos -->
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">
            Detalle de Ventas
          </h3>
          <div class="card-tools">
            <button mat-stroked-button
                    color="primary"
                    (click)="exportarExcel()"
                    class="export-btn">
              <mat-icon>description</mat-icon>
              Excel
            </button>
            <button mat-stroked-button
                    color="warn"
                    (click)="exportarPdf()"
                    class="export-btn">
              <mat-icon>picture_as_pdf</mat-icon>
              PDF
            </button>
          </div>
        </div>

        <div class="card-body">
          <div class="table-responsive">
            <table mat-table [dataSource]="dataSource" class="report-table">

              <!-- Columna Pedido ID -->
              <ng-container matColumnDef="pedidoId">
                <th mat-header-cell *matHeaderCellDef>Pedido #</th>
                <td mat-cell *matCellDef="let r" class="pedido-cell">
                  <span class="pedido-badge">#{{r.pedidoId}}</span>
                </td>
              </ng-container>

              <!-- Columna Fecha -->
              <ng-container matColumnDef="fechaVenta">
                <th mat-header-cell *matHeaderCellDef>Fecha</th>
                <td mat-cell *matCellDef="let r">
                  {{r.fechaVenta | date:'dd/MM/yyyy HH:mm'}}
                </td>
              </ng-container>

              <!-- Columna Tipo -->
              <ng-container matColumnDef="tipoVenta">
                <th mat-header-cell *matHeaderCellDef>Tipo</th>
                <td mat-cell *matCellDef="let r">
                  <span class="tipo-badge"
                        [class.tipo-online]="r.tipoVenta === 'EnLinea'"
                        [class.tipo-tienda]="r.tipoVenta === 'EnTienda'">
                    {{r.tipoVenta === 'EnLinea' ? 'En Línea' : 'En Tienda'}}
                  </span>
                </td>
              </ng-container>

              <!-- Columna Cliente -->
              <ng-container matColumnDef="clienteNombre">
                <th mat-header-cell *matHeaderCellDef>Cliente</th>
                <td mat-cell *matCellDef="let r" class="cliente-cell">
                  <div class="cliente-info">
                    <mat-icon class="cliente-icon">person</mat-icon>
                    <span>{{r.clienteNombre}}</span>
                  </div>
                </td>
              </ng-container>

              <!-- Columna Items -->
              <ng-container matColumnDef="totalItems">
                <th mat-header-cell *matHeaderCellDef># Items</th>
                <td mat-cell *matCellDef="let r" class="items-cell">
                  {{r.totalItems}}
                </td>
              </ng-container>

              <!-- Columna Total Bruto -->
              <ng-container matColumnDef="montoTotal">
                <th mat-header-cell *matHeaderCellDef>Total Bruto</th>
                <td mat-cell *matCellDef="let r" class="amount-cell">
                  {{r.montoTotal | currency:'GTQ':'Q'}}
                </td>
              </ng-container>

              <!-- Columna Devuelto -->
              <ng-container matColumnDef="montoDevuelto">
                <th mat-header-cell *matHeaderCellDef>Devuelto</th>
                <td mat-cell *matCellDef="let r" class="debit-amount">
                  <span *ngIf="r.montoDevuelto > 0">
                    -{{r.montoDevuelto | currency:'GTQ':'Q'}}
                  </span>
                  <span *ngIf="r.montoDevuelto === 0">-</span>
                </td>
              </ng-container>

              <!-- Columna Venta Neta -->
              <ng-container matColumnDef="ventaNeta">
                <th mat-header-cell *matHeaderCellDef>Venta Neta</th>
                <td mat-cell *matCellDef="let r" class="neta-amount">
                  {{r.ventaNeta | currency:'GTQ':'Q'}}
                </td>
              </ng-container>

              <!-- Columna IVA -->
              <ng-container matColumnDef="iva">
                <th mat-header-cell *matHeaderCellDef>IVA</th>
                <td mat-cell *matCellDef="let r" class="iva-amount">
                  {{r.iva | currency:'GTQ':'Q'}}
                </td>
              </ng-container>

              <!-- Columna Ganancia -->
              <ng-container matColumnDef="ganancia">
                <th mat-header-cell *matHeaderCellDef>Ganancia</th>
                <td mat-cell *matCellDef="let r" class="ganancia-amount">
                  {{r.ganancia | currency:'GTQ':'Q'}}
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="table-row"></tr>
            </table>
          </div>
        </div>
      </div>

    </div>

    <!-- Mensaje sin datos -->
    <div *ngIf="dataSource.data.length === 0" class="no-data-card card">
      <div class="card-body">
        <div class="no-data-message">
          <mat-icon>assessment</mat-icon>
          <h3>No hay datos para mostrar</h3>
          <p>Selecciona un rango de fechas y tipo de venta para generar el reporte</p>
        </div>
      </div>
    </div>

  </div>
</section>
