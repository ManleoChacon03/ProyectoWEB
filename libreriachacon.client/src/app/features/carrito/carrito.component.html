<!-- Content Header -->
<div class="content-header">
  <div class="container-fluid">
    <div class="row mb-2">
      <div class="col-sm-6">
        <h1 class="m-0">
          Mi Carrito de Compras
        </h1>
      </div>
      <div class="col-sm-6">
        
      </div>
    </div>
  </div>
</div>

<!-- Main content -->
<section class="content">
  <div class="container-fluid">

    <!-- Carrito con items -->
    <div *ngIf="cartItems.length > 0; else emptyCart" class="cart-section">

      <div class="row">
        <!-- Tabla de productos -->
        <div class="col-lg-8">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">
                Productos en el Carrito
              </h3>
              <div class="card-badge">
                <span class="badge-info">{{cartItems.length}} {{cartItems.length === 1 ? 'producto' : 'productos'}}</span>
              </div>
            </div>

            <div class="card-body">
              <div class="table-responsive">
                <table mat-table [dataSource]="cartItems" class="cart-table">

                  <!-- Columna Producto -->
                  <ng-container matColumnDef="producto">
                    <th mat-header-cell *matHeaderCellDef>Producto</th>
                    <td mat-cell *matCellDef="let item">
                      <div class="product-cell">
                        <div class="product-image">
                          <img [src]="item.producto.imagenUrl || 'https://via.placeholder.com/80'"
                               alt="{{item.producto.nombre}}">
                        </div>
                        <div class="product-info">
                          <span class="product-name">{{ item.producto.nombre }}</span>
                          <span class="product-stock">Stock: {{ item.producto.cantidadStock }}</span>
                        </div>
                      </div>
                    </td>
                  </ng-container>

                  <!-- Columna Precio -->
                  <ng-container matColumnDef="precio">
                    <th mat-header-cell *matHeaderCellDef>Precio Unit.</th>
                    <td mat-cell *matCellDef="let item" class="price-cell">
                      {{ item.producto.precio | currency:'GTQ':'Q' }}
                    </td>
                  </ng-container>

                  <!-- Columna Cantidad -->
                  <ng-container matColumnDef="cantidad">
                    <th mat-header-cell *matHeaderCellDef>Cantidad</th>
                    <td mat-cell *matCellDef="let item">
                      <div class="quantity-control">
                        <input type="number"
                               [value]="item.cantidad"
                               (change)="actualizarCantidad(item, $event)"
                               min="1"
                               [max]="item.producto.cantidadStock"
                               class="quantity-input">
                      </div>
                    </td>
                  </ng-container>

                  <!-- Columna Subtotal -->
                  <ng-container matColumnDef="subtotal">
                    <th mat-header-cell *matHeaderCellDef>Subtotal</th>
                    <td mat-cell *matCellDef="let item" class="subtotal-cell">
                      {{ calcularSubtotal(item) | currency:'GTQ':'Q' }}
                    </td>
                  </ng-container>

                  <!-- Columna Acciones -->
                  <ng-container matColumnDef="acciones">
                    <th mat-header-cell *matHeaderCellDef></th>
                    <td mat-cell *matCellDef="let item">
                      <button mat-icon-button
                              color="warn"
                              (click)="eliminarItem(item.producto.id)"
                              matTooltip="Eliminar del carrito">
                        <mat-icon>delete</mat-icon>
                      </button>
                    </td>
                  </ng-container>

                  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                  <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="table-row"></tr>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- Resumen del pedido -->
        <div class="col-lg-4">
          <div class="card summary-card">
            <div class="card-header">
              <h3 class="card-title">
                Resumen del Pedido
              </h3>
            </div>

            <div class="card-body">
              <div class="summary-details">
                <div class="summary-row">
                  <span>Productos:</span>
                  <strong>{{cartItems.length}}</strong>
                </div>

                <div class="summary-row">
                  <span>Unidades:</span>
                  <strong>{{getTotalUnidades()}}</strong>
                </div>

                <div class="summary-divider"></div>

                <div class="summary-row total-row">
                  <span>Total:</span>
                  <strong class="total-amount">{{ totalCarrito | currency:'GTQ':'Q' }}</strong>
                </div>
              </div>

              <button mat-raised-button
                      color="primary"
                      class="checkout-btn"
                      (click)="procederAlPago()">
                <mat-icon>payment</mat-icon>
                Proceder al Pago
              </button>

              <button mat-stroked-button
                      class="continue-btn"
                      routerLink="/productos">
                <mat-icon>arrow_back</mat-icon>
                Seguir Comprando
              </button>
            </div>
          </div>

          <!-- Info adicional -->
          <div class="info-card card">
            <div class="card-body">
              <div class="info-item">
                <div class="info-text">
                  <strong>Envío</strong>
                  <span>Calculado en el checkout</span>
                </div>
              </div>
              <div class="info-item">
                <div class="info-text">
                  <strong>Compra Segura</strong>
                  <span>Protegemos tus datos</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>

    <!-- Carrito vacío -->
    <ng-template #emptyCart>
      <div class="card empty-cart-card">
        <div class="card-body">
          <div class="empty-cart-content">
            <mat-icon>remove_shopping_cart</mat-icon>
            <h2>Tu carrito está vacío</h2>
            <p>Añade productos desde el catálogo para verlos aquí</p>
            <button mat-raised-button color="primary" routerLink="/productos">
              <mat-icon>store</mat-icon>
              Ir al Catálogo
            </button>
          </div>
        </div>
      </div>
    </ng-template>

  </div>
</section>
